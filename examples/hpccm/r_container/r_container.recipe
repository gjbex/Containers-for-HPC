BootStrap: docker
From: ubuntu:22.04
%post
    . /.singularity.d/env/10-docker*.sh

%post
    apt-get update -y
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
        apt-transport-https \
        binutils \
        binutils-common \
        build-essential \
        bzip2 \
        curl \
        dirmngr \
        gdal-bin \
        gettext \
        gettext-base \
        ghostscript \
        gist \
        gnupg \
        gzip \
        hwloc \
        imagemagick \
        lame \
        libarchive-dev \
        libarmadillo-dev \
        libarpack++2-dev \
        libarpack2 \
        libarpack2-dev \
        libbz2-dev \
        libcairo2-dev \
        libcfitsio-dev \
        libcurl4 \
        libcurl4-openssl-dev \
        libdeflate-dev \
        libdrm-dev \
        libevent-dev \
        libexpat1-dev \
        libfabric-dev \
        libffi-dev \
        libflac-dev \
        libfontconfig-dev \
        libfreetype6-dev \
        libfribidi-dev \
        libgdal-dev \
        libgeos++-dev \
        libgeos-dev \
        libgeotiff-dev \
        libgif-dev \
        libgit2-dev \
        libgl1-mesa-dev \
        libglib2.0-dev \
        libglpk-dev \
        libglu1-mesa-dev \
        libglvnd-dev \
        libgmp-dev \
        libgsl-dev \
        libharfbuzz-dev \
        libhdf5-dev \
        libhwloc-dev \
        libicu-dev \
        libjbig-dev \
        libjpeg-turbo8-dev \
        libjson-c-dev \
        liblapack-dev \
        liblcms2-dev \
        liblerc-dev \
        liblz4-dev \
        liblzma-dev \
        libmagickcore-dev \
        libmagickwand-dev \
        libmp3lame-dev \
        libmpfr-dev \
        libncurses-dev \
        libnetcdf-dev \
        libnlopt-dev \
        libnuma-dev \
        libogg-dev \
        libopenblas-base \
        libopenblas-dev \
        libopenexr-dev \
        libopenjp2-7-dev \
        libopenmpi-dev \
        libopus-dev \
        libpango1.0-dev \
        libpciaccess-dev \
        libpcre2-dev \
        libpcre3-dev \
        libpixman-1-0 \
        libpixman-1-dev \
        libpmix-bin \
        libpmix-dev \
        libpng-dev \
        libpq-dev \
        libproj-dev \
        libqhull-dev \
        libreadline-dev \
        libreadline8 \
        libscalapack-mpi-dev \
        libscalapack-openmpi-dev \
        libsndfile1-dev \
        libssl-dev \
        libsz2 \
        libtiff-dev \
        libtirpc-dev \
        libucx-dev \
        libudunits2-dev \
        libunwind-dev \
        libvorbis-dev \
        libwayland-dev \
        libx11-dev \
        libxerces-c-dev \
        libxml2-dev \
        llvm-dev \
        make \
        nasm \
        nodejs \
        npm \
        openexr \
        openjdk-17-jdk \
        openjdk-17-jre \
        openmpi-bin \
        openssl \
        proj-bin \
        proj-data \
        python3 \
        python3-cffi \
        python3-cryptography \
        python3-dev \
        python3-numpy \
        python3-pip \
        python3-pybind11 \
        python3-scipy \
        python3-virtualenv \
        rclone \
        software-properties-common \
        sqlite3 \
        swig \
        tcl \
        tcl-dev \
        tk \
        tk-dev \
        ucx-utils \
        udunits-bin \
        util-linux \
        wayland-protocols \
        wget \
        xorg \
        xutils-dev \
        xz-utils \
        zlib1g \
        zlib1g-dev \
        zstd
    rm -rf /var/lib/apt/lists/*

%post
    cd /
    wget -qO- https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc | tee -a /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc

%post
    cd /
    add-apt-repository "deb https://cloud.r-project.org/bin/linux/ubuntu $(lsb_release -cs)-cran40/"

%post
    cd /
    apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 51716619E084DAB9

# CMake version 3.25.1
%post
    apt-get update -y
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
        make \
        wget
    rm -rf /var/lib/apt/lists/*
%post
    cd /
    mkdir -p /var/tmp && wget -q -nc --no-check-certificate -P /var/tmp https://github.com/Kitware/CMake/releases/download/v3.25.1/cmake-3.25.1-linux-x86_64.sh
    mkdir -p /usr/local
    /bin/sh /var/tmp/cmake-3.25.1-linux-x86_64.sh --prefix=/usr/local --skip-license
    rm -rf /var/tmp/cmake-3.25.1-linux-x86_64.sh
%environment
    export PATH=/usr/local/bin:$PATH
%post
    export PATH=/usr/local/bin:$PATH

# GNU compiler
%post
    apt-get update -y
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
        g++ \
        gcc \
        gfortran
    rm -rf /var/lib/apt/lists/*

%post
    apt-get update -y
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
        r-base \
        r-base-dev \
        r-cran-biocmanager
    rm -rf /var/lib/apt/lists/*

%setup
    mkdir -p ${SINGULARITY_ROOTFS}/setup
%files
    ./install_packages.R /setup/

%post
    cd /
    Rscript /setup/./install_packages.R

%environment
    export LC_ALL=C.UTF-8
%post
    export LC_ALL=C.UTF-8

%environment
    export TZ=Europe/Brussels
%post
    export TZ=Europe/Brussels

%runscript
    exec Rscript "$@"


